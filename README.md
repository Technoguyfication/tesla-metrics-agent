# Tesla-Metrics-Agent
 InfluxDB data source for reporting Tesla vehicle metrics.
 
 Report metrics such as vehicle location, speed, climate control settings, charge rate, and more!

 # Setup and Installation

**Prerequisites:**
- A Tesla vehicle
- [InfluxDB Time Series Database](https://www.influxdata.com/get-influxdb/) (Only version 2 and above is supported!)
- Basic understanding of InfluxDB + FluxQL or a willingness to learn
- [A Tesla API Token](#obtaining-a-token)

Choose one of the following deployment methods:

 ## Docker (Recommended)
 
 ```
docker run --name tesla-metrics-agent \
    -e TESLA_REFRESH_TOKEN="See repository readme to obtain your refresh token" \
    -e INFLUXDB_URL="https://your-influx-db.example.com" \
    -e INFLUXDB_TOKEN="your-token-here" \
    -e INFLUXDB_ORG="your-org-here" \
    -e INFLUXDB_BUCKET="tesla-metrics" \
    ghcr.io/technoguyfication/tesla-metrics-agent:master
```
 
 Or with docker-compose:
 
 ```yaml
 version: "3.8"

services:
  collector:
    image: ghcr.io/technoguyfication/tesla-metrics-agent:master
    environment:
      TESLA_REFRESH_TOKEN: "See repository readme to obtain your refresh token"
      INFLUXDB_URL: "https://your-influx-db.example.com"
      INFLUXDB_TOKEN: "your-token-here"
      INFLUXDB_ORG: "your-org-here"
      INFLUXDB_BUCKET: "tesla-metrics"
      VERBOSE: false # If you're having issues, change this to true to output more data
    restart: unless-stopped
```

## Standalone Installation

Bare metal installation isn't supported yet! You can always download the source code yourself and figure it out.

# Screenshots

### InfluxDB Explorer:
![image](https://user-images.githubusercontent.com/8218061/186053750-b9fb7aad-f3b3-4d71-8c34-d843b25843a9.png)

### Example Charging Dashboard in Grafana:
![image](https://user-images.githubusercontent.com/8218061/186053785-38a74116-3655-4815-8f8a-412f617f2819.png)

# Obtaining a Token

Tesla uses a non-traditional OAuth flow, and currently the easiest way to obtain a token is by using one of the following mobile apps:

- iOS: [Auth app for Tesla](https://apps.apple.com/us/app/auth-app-for-tesla/id1552058613)
- Android: [Tesla Tokens](https://play.google.com/store/apps/details?id=net.leveugle.teslatokens&hl=en_US&gl=US)

You need the **refresh token** generated by these apps. The access token can be ignored when setting up this software.


If you would like to attempt to get your token manually, please read the [following article](https://tesla-api.timdorr.com/api-basics/authentication) on how the flow works.

# References

- [Tesla API Reference](https://tesla-api.timdorr.com/) by [@timdorr](https://github.com/timdorr)
